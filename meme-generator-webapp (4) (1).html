<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSignal Meme Generator</title>
    <style>
        /* Styles remain unchanged */
    </style>
</head>
<body>
    <!-- HTML structure remains unchanged -->

    <script>
        // Most of the JavaScript remains unchanged. We'll only modify the drawText function in the downloadButton event listener.

        downloadButton.addEventListener('click', function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = originalImage.width;
            canvas.height = originalImage.height;
            
            ctx.drawImage(originalImage, 0, 0);
            
            const scaleX = canvas.width / previewContainer.offsetWidth;
            const scaleY = canvas.height / previewContainer.offsetHeight;

            ctx.fillStyle = 'white';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = parseInt(borderWidth.value) * scaleX;
            ctx.textAlign = 'center';

            function drawText(text, element, fontSize) {
                ctx.font = `${fontSize * scaleY}px Impact`;
                let x, y;
                
                if (element.style.transform === 'none') {
                    // Text has been moved, use its current position
                    x = (element.offsetLeft + element.offsetWidth / 2) * scaleX;
                    y = (element.offsetTop + fontSize / 2) * scaleY; // Adjust for text baseline
                } else {
                    // Text is in default position, center it
                    x = canvas.width / 2;
                    if (element.id === 'topTextPreview') {
                        y = (10 + fontSize / 2) * scaleY; // Adjust top text position
                    } else {
                        y = canvas.height - (10 + fontSize / 2) * scaleY; // Bottom text position
                    }
                }

                ctx.fillText(text, x, y);
                ctx.strokeText(text, x, y);
            }

            drawText(topText.value.toUpperCase(), topTextPreview, parseInt(topFontSize.value));
            drawText(bottomText.value.toUpperCase(), bottomTextPreview, parseInt(bottomFontSize.value));

            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'codesignal_meme.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }, 'image/png');
        });

        // Rest of the script remains unchanged
    </script>
</body>
</html>
